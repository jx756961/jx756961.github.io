<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>php类对象拷贝、类型约束、Trait</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
<h2 style="text-align: center">php类对象拷贝、类型约束、Trait</h2>
  <div class="stackedit__html"><h5><a id="1_0"></a>1.对象拷贝</h5>
<ul>
<li>浅拷贝这样比较省空间。php默认是浅拷贝</li>
</ul>
<pre><code class="prism language-php">	<span class="token comment">//浅拷贝这样$b与$a共用一个内存空间。 </span>
	<span class="token keyword">class</span> <span class="token class-name">ObjCopy</span>
	<span class="token punctuation">{</span>
	    <span class="token keyword">public</span> <span class="token variable">$age</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	    <span class="token keyword">public</span> <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token single-quoted-string string">''</span><span class="token punctuation">;</span>
	
	<span class="token comment">//    对象属性</span>
	    <span class="token keyword">public</span> <span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">//调用</span>
	<span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjCopy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token variable">$b</span> <span class="token operator">=</span> <span class="token variable">$a</span><span class="token punctuation">;</span>
	<span class="token variable">$b</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">age</span> <span class="token operator">=</span> <span class="token number">22</span><span class="token punctuation">;</span>
	<span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">age</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//输出： int(22)</span>
</code></pre>
<ul>
<li>深拷贝1. 普通变量操作</li>
</ul>
<pre><code class="prism language-php">	<span class="token comment">//$b重新复制一个副本单独存储。 </span>
	<span class="token keyword">class</span> <span class="token class-name">ObjCopy</span>
	<span class="token punctuation">{</span>
	    <span class="token keyword">public</span> <span class="token variable">$age</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	    <span class="token keyword">public</span> <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token single-quoted-string string">''</span><span class="token punctuation">;</span>
	
	<span class="token comment">//    对象属性</span>
	    <span class="token keyword">public</span> <span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">//调用</span>
	<span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjCopy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token variable">$b</span> <span class="token operator">=</span> clone <span class="token variable">$a</span><span class="token punctuation">;</span>
	<span class="token variable">$b</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">age</span> <span class="token operator">=</span> <span class="token number">22</span><span class="token punctuation">;</span>
	<span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">age</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//输出： int(0)</span>
</code></pre>
<ul>
<li>深拷贝2. 对象变量操作,需要使用魔术方法</li>
</ul>
<blockquote>
<p><strong>__clone()</strong></p>
</blockquote>
<p>请看示例</p>
<pre><code class="prism language-php">	<span class="token keyword">class</span> <span class="token class-name">ObjCopy</span>
	<span class="token punctuation">{</span>
	    <span class="token keyword">public</span> <span class="token variable">$age</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	    <span class="token keyword">public</span> <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token single-quoted-string string">''</span><span class="token punctuation">;</span>
	
	    <span class="token comment">//对象属性</span>
	    <span class="token keyword">public</span> <span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	
	    <span class="token comment">//这里定义魔术方法</span>
	    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	    <span class="token punctuation">{</span>
	        <span class="token comment">//这里成员变量拷贝一份重新赋值给 $this-&gt;obj</span>
	        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">obj</span> <span class="token operator">=</span> clone <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">obj</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">class</span> <span class="token class-name">ObjCopy2</span>
	<span class="token punctuation">{</span>
	    <span class="token keyword">public</span> <span class="token variable">$sex</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjCopy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">obj</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjCopy2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token variable">$b</span> <span class="token operator">=</span> clone <span class="token variable">$a</span><span class="token punctuation">;</span><span class="token comment">//这里赋值直接使用 clone 关键字不起作用,需要用到__clone()魔术方法,上面做了定义。这样$a和$b就是两个空间的内容</span>
	<span class="token variable">$b</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">obj</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">sex</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token comment">//$b-&gt;age = 22;</span>
	<span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">obj</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">sex</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h5><a id="2__71"></a>2. 类型约束</h5>
<blockquote>
<p><strong>注：类型约束不能用于标量类型如 int 或 string。Traits 也不允许。</strong> 以下引用官方示例其他参考官方示例<br>
<strong>可以添加约束的有 数组约束<code>public function test_array(array $input_array){}</code> 回调类型<code>public function test_callable(callable $callback, $data){}</code></strong></p>
</blockquote>
<ul>
<li>成员方法对象约束</li>
</ul>
<pre><code class="prism language-php">	<span class="token comment">//MyClass类定义</span>
	<span class="token keyword">class</span> <span class="token class-name">MyClass</span>
	<span class="token punctuation">{</span>
	    <span class="token comment">/**
	     * 第一个参数必须为 OtherClass 类的一个对象
	     */</span>
	    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span>OtherClass <span class="token variable">$otherclass</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	        <span class="token keyword">echo</span> <span class="token variable">$otherclass</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token keyword">var</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">// OtherClass 类定义</span>
	<span class="token keyword">class</span> <span class="token class-name">OtherClass</span> <span class="token punctuation">{</span>
	    <span class="token keyword">public</span> <span class="token variable">$var</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'Hello World'</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 两个类的对象</span>
	<span class="token variable">$myclass</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyClass</span><span class="token punctuation">;</span>
	<span class="token variable">$otherclass</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OtherClass</span><span class="token punctuation">;</span>
	<span class="token variable">$myclass</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 致命错误：第一个参数必须是 OtherClass 类的一个对象,hello为字符串</span>
	<span class="token variable">$myclass</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">stdClass</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 致命错误：第一个参数必须为 OtherClass 类的一个实例,实例对象不符</span>
	<span class="token variable">$myclass</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token variable">$otherclass</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//  √  必须为OtherClass实例对象</span>
</code></pre>
<ul>
<li>函数里使用类型约束,跟成员方法用法一致,以下示例</li>
</ul>
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
	<span class="token comment">// 如下面的类</span>
	<span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
	    <span class="token keyword">public</span> <span class="token variable">$var</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'Hello World'</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">/**
	 * 第一个参数必须是 MyClass 类的一个对象
	 */</span>
	<span class="token keyword">function</span> MyFunction <span class="token punctuation">(</span>MyClass <span class="token variable">$foo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token keyword">echo</span> <span class="token variable">$foo</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token keyword">var</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 正确</span>
	<span class="token variable">$myclass</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyClass</span><span class="token punctuation">;</span>
	<span class="token function">MyFunction</span><span class="token punctuation">(</span><span class="token variable">$myclass</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token delimiter important">?&gt;</span>
</code></pre>
<h5><a id="3Trait_117"></a>3.Trait</h5>
<blockquote>
<p>php 是单继承语言,所以为了减少单继承语言的限制 。PHP 5.4.0 起，PHP 实现了一种代码复用的方法，称为 trait。</p>
</blockquote>
<pre><code class="prism language-php">	<span class="token keyword">trait</span> <span class="token class-name">Test</span>
	<span class="token punctuation">{</span>
	    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">one</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	    <span class="token punctuation">{</span>
	        <span class="token keyword">echo</span> <span class="token single-quoted-string string">'hello '</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">two</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	    <span class="token punctuation">{</span>
	        <span class="token keyword">echo</span> <span class="token single-quoted-string string">'world'</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">ot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	    <span class="token punctuation">{</span>
	        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">one</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">two</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">trait</span> <span class="token class-name">Test2</span><span class="token punctuation">{</span>
	    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">three</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	        <span class="token keyword">echo</span> <span class="token single-quoted-string string">'this is test2'</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">trait</span> <span class="token class-name">Test1</span>
	<span class="token punctuation">{</span>
	    <span class="token keyword">use</span> <span class="token package">Test</span><span class="token punctuation">,</span>Test2<span class="token punctuation">;</span><span class="token comment">// 使用use关键字引用Test内所有的属性和方法。相当于继承 .多个trait使用use 中用逗号隔开</span>
	<span class="token punctuation">}</span>
	<span class="token variable">$ObjTrait</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token variable">$ObjTrait</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">ot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//输出： hello world</span>
	<span class="token variable">$ObjTrait</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">three</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//输出：this is test2</span>
	
</code></pre>
</div>
</body>

</html>
