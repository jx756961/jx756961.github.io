<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>php封装PDO类</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
<h2 style="text-align: center">php封装PDO类</h2>
  <div class="stackedit__html"><pre><code class="prism language-javascript">
	<span class="token keyword">class</span> <span class="token class-name">pdoManager</span>
	<span class="token punctuation">{</span>
	    <span class="token keyword">private</span> $conn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	
	    <span class="token comment">/**
	     * 创建数据库链接对象
	     */</span>
	    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>$host<span class="token punctuation">,</span>$user<span class="token punctuation">,</span>$pwd<span class="token punctuation">)</span><span class="token punctuation">{</span>
	        <span class="token keyword">try</span><span class="token punctuation">{</span>
	            $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PDO</span><span class="token punctuation">(</span>$host<span class="token punctuation">,</span>$user<span class="token punctuation">,</span>$pwd<span class="token punctuation">)</span><span class="token punctuation">;</span>
	            $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>conn<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'set names utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	            $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>conn<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token constant">PDO</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">ATTR_ERRMODE</span><span class="token punctuation">,</span><span class="token constant">PDO</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">ERRMODE_EXCEPTION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">PDOException</span> $e<span class="token punctuation">)</span><span class="token punctuation">{</span>
	            <span class="token function">die</span><span class="token punctuation">(</span><span class="token string">'err：'</span><span class="token punctuation">.</span>$e<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	        <span class="token punctuation">}</span>
	    <span class="token punctuation">}</span>
	
	    <span class="token comment">/**
	     * 增删改方法
	     */</span>
	    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">toExec</span><span class="token punctuation">(</span>$sql<span class="token punctuation">)</span><span class="token punctuation">{</span>
	        <span class="token keyword">try</span><span class="token punctuation">{</span>
	            $result <span class="token operator">=</span> $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>conn<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">exec</span><span class="token punctuation">(</span>$sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
	            <span class="token keyword">return</span> $result<span class="token punctuation">;</span>
	        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">PDOException</span> $e<span class="token punctuation">)</span><span class="token punctuation">{</span>
	            <span class="token function">die</span><span class="token punctuation">(</span><span class="token string">'err：'</span><span class="token punctuation">.</span>$e<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	        <span class="token punctuation">}</span>
	    <span class="token punctuation">}</span>
	
	    <span class="token comment">/**
	     * 数据查询方法
	     */</span>
	    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getData</span><span class="token punctuation">(</span>$sql<span class="token punctuation">,</span>$isMore <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	        <span class="token keyword">try</span><span class="token punctuation">{</span>
	            $result <span class="token operator">=</span> $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>conn<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">query</span><span class="token punctuation">(</span>$sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
	            <span class="token keyword">if</span><span class="token punctuation">(</span>$isMore<span class="token punctuation">)</span><span class="token punctuation">{</span>
	                $content <span class="token operator">=</span> $result<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">fetchAll</span><span class="token punctuation">(</span><span class="token constant">PDO</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">FETCH_ASSOC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
	                $content <span class="token operator">=</span> $result<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token constant">PDO</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">FETCH_ASSOC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	            <span class="token punctuation">}</span>
	            <span class="token keyword">return</span> $content<span class="token punctuation">;</span>
	        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">PDOException</span> $e<span class="token punctuation">)</span><span class="token punctuation">{</span>
	            <span class="token function">die</span><span class="token punctuation">(</span><span class="token string">'err：'</span><span class="token punctuation">.</span>$e<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	        <span class="token punctuation">}</span>
	    <span class="token punctuation">}</span>
	
	    <span class="token comment">/**
	     * 释放PDO对象
	     */</span>
	    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	        $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>conn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
</code></pre>
</div>
</body>

</html>
