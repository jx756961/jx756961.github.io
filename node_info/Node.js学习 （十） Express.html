<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Node.js学习 （十） Express</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
<h2 style="text-align: center">Node.js学习 （十） Express</h2>
  <div class="stackedit__html"><blockquote>
<p>这里先说安装一个服务自动重启工具 <code>nodemon</code>  ,这个工具省去我们手动重启node服务的步骤非常方便</p>
</blockquote>
<pre><code class="prism language-shell"><span class="token function">npm</span> <span class="token function">install</span> --global nodemon 
</code></pre>
<h5><a id="_4"></a>路由</h5>
<pre><code class="prism language-javascript"><span class="token comment">//express搭建服务器</span>
<span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>get:</p>
<blockquote>
<p><code>app.get()</code>  当网络以 <code>GET</code> 方式请求服务 <code>/</code> 的时候</p>
</blockquote>
<pre><code class="prism language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//返回数据</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`这里是一个明文请求`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>post:</p>
<blockquote>
<p><code>app.post()</code>  当网络以 <code>POST</code> 方式请求服务 <code>/</code> 的时候</p>
</blockquote>
<pre><code class="prism language-javascript">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//返回数据</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`这里是一个密文请求`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h5><a id="Expressarttemplete_26"></a>Express使用art-templete</h5>
<blockquote>
<p><code>app.engine('art', require('express-art-template'))</code> 第一个参数，表示，当渲染以 <code>.art</code> 结尾的文件的时候，使用 <code>art-template</code> 模板引擎<br>
<code>express-art-template</code> 是专门用来在 <code>Express</code> 中把 <code>art-template</code> 整合到 <code>Express</code> 中<br>
虽然外面这里不需要记载 <code>art-template</code> 但是也必须安装<br>
原因就在于 <code>express-art-template 依赖了 art-template</code></p>
</blockquote>
<pre><code class="prism language-javascript"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token comment">//POST数据解析插件</span>
<span class="token keyword">var</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/public/'</span><span class="token punctuation">,</span> express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span><span class="token string">'./public/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 配置使用 art-template 模板引擎</span>
app<span class="token punctuation">.</span><span class="token function">engine</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-art-template'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// Express 为 Response 相应对象提供了一个方法：render</span>
<span class="token comment">// render 方法默认是不可以使用，但是如果配置了模板引擎就可以使用了</span>

<span class="token comment">// res.render('html模板名', {模板数据})</span>

<span class="token comment">// 第一个参数不能写路径，默认会去项目中的 views 目录查找该模板文件</span>
<span class="token comment">// 也就是说 Express 有一个约定：开发人员把所有的视图文件都放到 views 目录中</span>

<span class="token comment">// 如果想要修改默认的 views 目录，则可以</span>
<span class="token comment">// app.set('views', render函数的默认路径)</span>

<span class="token comment">// 配置 body-parser 中间件（插件，专门用来解析表单 POST 请求体）</span>
<span class="token comment">// parse application/x-www-form-urlencoded</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> extended<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// parse application/json</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> comments <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'张三'</span><span class="token punctuation">,</span>
    message<span class="token punctuation">:</span> <span class="token string">'今天天气不错！'</span><span class="token punctuation">,</span>
    dateTime<span class="token punctuation">:</span> <span class="token string">'2015-10-16'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'张三2'</span><span class="token punctuation">,</span>
    message<span class="token punctuation">:</span> <span class="token string">'今天天气不错！'</span><span class="token punctuation">,</span>
    dateTime<span class="token punctuation">:</span> <span class="token string">'2015-10-16'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'张三3'</span><span class="token punctuation">,</span>
    message<span class="token punctuation">:</span> <span class="token string">'今天天气不错！'</span><span class="token punctuation">,</span>
    dateTime<span class="token punctuation">:</span> <span class="token string">'2015-10-16'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'张三4'</span><span class="token punctuation">,</span>
    message<span class="token punctuation">:</span> <span class="token string">'今天天气不错！'</span><span class="token punctuation">,</span>
    dateTime<span class="token punctuation">:</span> <span class="token string">'2015-10-16'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'张三5'</span><span class="token punctuation">,</span>
    message<span class="token punctuation">:</span> <span class="token string">'今天天气不错！'</span><span class="token punctuation">,</span>
    dateTime<span class="token punctuation">:</span> <span class="token string">'2015-10-16'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    comments<span class="token punctuation">:</span> comments
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/post'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'post.html'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 当以 POST 请求 /post 的时候，执行指定的处理函数</span>
<span class="token comment">// 这样的话我们就可以利用不同的请求方法让一个请求路径使用多次</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/post'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1. 获取表单 POST 请求体数据</span>
  <span class="token comment">// 2. 处理</span>
  <span class="token comment">// 3. 发送响应</span>

  <span class="token comment">// req.query 只能拿 get 请求参数</span>
  <span class="token comment">// console.log(req.query)</span>

  <span class="token comment">//通过req.body 获取表单POST数据,获取的数据json格式  就好像req.query获取GET数据类似</span>
  <span class="token keyword">var</span> comment <span class="token operator">=</span> req<span class="token punctuation">.</span>body
  comment<span class="token punctuation">.</span>dateTime <span class="token operator">=</span> <span class="token string">'2017-11-5 10:58:51'</span>
  comments<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>comment<span class="token punctuation">)</span>

  <span class="token comment">// res.send</span>
  <span class="token comment">// res.redirect</span>
  <span class="token comment">// 这些方法 Express 会自动结束响应</span>
  res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
  <span class="token comment">// res.statusCode = 302</span>
  <span class="token comment">// res.setHeader('Location', '/') </span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// app.get('/pinglun', function (req, res) {</span>
<span class="token comment">//   var comment = req.query</span>
<span class="token comment">//   comment.dateTime = '2017-11-5 10:58:51'</span>
<span class="token comment">//   comments.unshift(comment)</span>
<span class="token comment">//   res.redirect('/')</span>
<span class="token comment">//   // res.statusCode = 302</span>
<span class="token comment">//   // res.setHeader('Location', '/')</span>
<span class="token comment">// })</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'running...'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre>
</div>
</body>

</html>
