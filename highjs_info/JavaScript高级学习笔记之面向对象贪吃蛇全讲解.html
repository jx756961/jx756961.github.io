<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JavaScript高级学习笔记之面向对象贪吃蛇全讲解</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
<h2 style="text-align: center">JavaScript高级学习笔记之面向对象贪吃蛇全讲解</h2>
  <div class="stackedit__html"><h2><a id="_2"></a>面向对象游戏案例：贪吃蛇</h2>
<p>案例相关源码以上传到 <a href="https://github.com/jx756961/eat-snake/tree/master">GitHub地址 </a></p>
<h3><a id="_6"></a>案例介绍</h3>
<h4><a id="_8"></a>游戏演示</h4>
<p>在线演示地址：<a href="http://www.lvjiaxing.top/snake.html">贪吃蛇</a></p>
<h4><a id="_12"></a>案例目标</h4>
<p>游戏的目的是用来体会js高级语法的使用 不需要具备抽象对象的能力，使用面向对象的方式分析问题，需要一个漫长的过程。</p>
<h3><a id="_16"></a>功能实现</h3>
<h4><a id="_18"></a>搭建页面</h4>
<p>放一个容器盛放游戏场景 div#map，设置样式</p>
<pre><code class="prism language-css"><span class="token selector">#map</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 800px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 600px<span class="token punctuation">;</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> #ccc<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h4><a id="_31"></a>分析对象</h4>
<ul>
<li>游戏对象</li>
<li>蛇对象</li>
<li>食物对象</li>
</ul>
<h4><a id="_37"></a>创建食物对象</h4>
<ul>
<li>
<p>Food</p>
<ul>
<li>
<p>属性</p>
<ul>
<li>x</li>
<li>y</li>
<li>width</li>
<li>height</li>
<li>color</li>
</ul>
</li>
<li>
<p>方法</p>
<ul>
<li>render       随机创建一个食物对象，并输出到map上</li>
</ul>
</li>
</ul>
</li>
<li>
<p>创建Food的构造函数，并设置属性</p>
</li>
</ul>
<pre><code class="prism language-js"><span class="token keyword">var</span> position <span class="token operator">=</span> <span class="token string">'absolute'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> elements <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">Food</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> color<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> x <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> y <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token comment">// 食物的宽度和高度(像素)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">=</span> width <span class="token operator">||</span> <span class="token number">20</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">=</span> height <span class="token operator">||</span> <span class="token number">20</span><span class="token punctuation">;</span>
  <span class="token comment">// 食物的颜色</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color <span class="token operator">||</span> <span class="token string">'green'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>通过原型设置render方法，实现随机产生食物对象，并渲染到map上</li>
</ul>
<pre><code class="prism language-js">Food<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>map<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 随机食物的位置，map.宽度/food.宽度，总共有多少分food的宽度，随机一下。然后再乘以food的宽度</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> map<span class="token punctuation">.</span>offsetWidth <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> map<span class="token punctuation">.</span>offsetHeight <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">;</span>

  <span class="token comment">// 动态创建食物对应的div</span>
  <span class="token keyword">var</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  map<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>
  div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> position<span class="token punctuation">;</span>
  div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
  div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
  div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
  div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
  div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>color<span class="token punctuation">;</span>
  elements<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>通过自调用函数，进行封装，通过window暴露Food对象</li>
</ul>
<pre><code class="prism language-js">window<span class="token punctuation">.</span>Food <span class="token operator">=</span> Food<span class="token punctuation">;</span>
</code></pre>
<h4><a id="_96"></a>创建蛇对象</h4>
<ul>
<li>
<p>Snake</p>
</li>
<li>
<p>属性</p>
<ul>
<li>width    蛇节的宽度 默认20</li>
<li>height   蛇节的高度 默认20</li>
<li>body     数组，蛇的头部和身体，第一个位置是蛇头</li>
<li>direction    蛇运动的方向  默认right  可以是 left  top bottom</li>
</ul>
</li>
<li>
<p>方法</p>
<ul>
<li>render  把蛇渲染到map上</li>
</ul>
</li>
<li>
<p>Snake构造函数</p>
</li>
</ul>
<pre><code class="prism language-js"><span class="token keyword">var</span> position <span class="token operator">=</span> <span class="token string">'absolute'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> elements <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">Snake</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> direction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 设置每一个蛇节的宽度</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">=</span> width <span class="token operator">||</span> <span class="token number">20</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">=</span> height <span class="token operator">||</span> <span class="token number">20</span><span class="token punctuation">;</span>
  <span class="token comment">// 蛇的每一部分, 第一部分是蛇头</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> color<span class="token punctuation">:</span> <span class="token string">'red'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> color<span class="token punctuation">:</span> <span class="token string">'red'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> color<span class="token punctuation">:</span> <span class="token string">'red'</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>direction <span class="token operator">=</span> direction <span class="token operator">||</span> <span class="token string">'right'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>render方法</li>
</ul>
<pre><code class="prism language-js">Snake<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>body<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>body<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>
    div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> obj<span class="token punctuation">.</span>x <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
    div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> obj<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
    div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> position<span class="token punctuation">;</span>
    div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> obj<span class="token punctuation">.</span>color<span class="token punctuation">;</span>
    div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
    div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>在自调用函数中暴露Snake对象</li>
</ul>
<pre><code class="prism language-js">window<span class="token punctuation">.</span>Snake <span class="token operator">=</span> Snake<span class="token punctuation">;</span>
</code></pre>
<h4><a id="_155"></a>创建游戏对象</h4>
<p>游戏对象，用来管理游戏中的所有对象和开始游戏</p>
<ul>
<li>
<p>Game</p>
<ul>
<li>
<p>属性</p>
<ul>
<li>
<p>food</p>
</li>
<li>
<p>snake</p>
</li>
<li>
<p>map</p>
</li>
</ul>
</li>
<li>
<p>方法</p>
<ul>
<li>start            开始游戏（绘制所有游戏对象）</li>
</ul>
</li>
</ul>
</li>
<li>
<p>构造函数</p>
</li>
</ul>
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">Game</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>food <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Food</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>snake <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Snake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>map <span class="token operator">=</span> map<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>开始游戏，渲染食物对象和蛇对象</li>
</ul>
<pre><code class="prism language-js">Game<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">start</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>food<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>snake<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3><a id="_194"></a>游戏的逻辑</h3>
<h4><a id="move_196"></a>写蛇的move方法</h4>
<ul>
<li>在蛇对象(snake.js)中，在Snake的原型上新增move方法</li>
</ul>
<ol>
<li>让蛇移动起来，把蛇身体的每一部分往前移动一下</li>
<li>蛇头部分根据不同的方向决定 往哪里移动</li>
</ol>
<pre><code class="prism language-js">Snake<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">move</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>food<span class="token punctuation">,</span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 让蛇身体的每一部分往前移动一下</span>
  <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>body<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>body<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>body<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>body<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>body<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 根据移动的方向，决定蛇头如何处理</span>
  <span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>direction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'left'</span><span class="token punctuation">:</span> 
      <span class="token keyword">this</span><span class="token punctuation">.</span>body<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'right'</span><span class="token punctuation">:</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>body<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'top'</span><span class="token punctuation">:</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>body<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'bottom'</span><span class="token punctuation">:</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>body<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>在game中测试</li>
</ul>
<pre><code class="prism language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>snake<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>food<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>snake<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h4><a id="_236"></a>让蛇自己动起来</h4>
<ul>
<li>
<p>私有方法</p>
<pre><code>什么是私有方法？
  不能被外部访问的方法
如何创建私有方法？
  使用自调用函数包裹
</code></pre>
</li>
<li>
<p>在game.js中 添加runSnake的私有方法，开启定时器调用蛇的move和render方法，让蛇动起来</p>
</li>
<li>
<p>判断蛇是否撞墙</p>
</li>
</ul>
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">runSnake</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> timerId <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>snake<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>food<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 在渲染前，删除之前的蛇</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>snake<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 判断蛇是否撞墙</span>
    <span class="token keyword">var</span> maxX <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span>offsetWidth <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>snake<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
    <span class="token keyword">var</span> maxY <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span>offsetHeight <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>snake<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
    <span class="token keyword">var</span> headX <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>snake<span class="token punctuation">.</span>body<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span>
    <span class="token keyword">var</span> headY <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>snake<span class="token punctuation">.</span>body<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>headX <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> headX <span class="token operator">&gt;=</span> maxX<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>timerId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Game Over'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>headY <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> headY <span class="token operator">&gt;=</span> maxY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>timerId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Game Over'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>that<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>在snake中添加删除蛇的私有方法，在render中调用</li>
</ul>
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 删除渲染的蛇</span>
  <span class="token keyword">var</span> i <span class="token operator">=</span> elements<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 删除页面上渲染的蛇</span>
    elements<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>elements<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 删除elements数组中的元素</span>
    elements<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>在game中通过键盘控制蛇的移动方向</li>
</ul>
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">bindKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keydown'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>keyCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token number">37</span><span class="token punctuation">:</span>
        <span class="token comment">// left</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>snake<span class="token punctuation">.</span>direction <span class="token operator">=</span> <span class="token string">'left'</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">38</span><span class="token punctuation">:</span>
        <span class="token comment">// top</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>snake<span class="token punctuation">.</span>direction <span class="token operator">=</span> <span class="token string">'top'</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">39</span><span class="token punctuation">:</span>
        <span class="token comment">// right</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>snake<span class="token punctuation">.</span>direction <span class="token operator">=</span> <span class="token string">'right'</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">40</span><span class="token punctuation">:</span>
        <span class="token comment">// bottom</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>snake<span class="token punctuation">.</span>direction <span class="token operator">=</span> <span class="token string">'bottom'</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>that<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>在start方法中调用</li>
</ul>
<pre><code class="prism language-js"><span class="token function">bindKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h4><a id="_324"></a>判断蛇是否吃到食物</h4>
<pre><code class="prism language-js"><span class="token comment">// 在Snake的move方法中</span>

<span class="token comment">// 在移动的过程中判断蛇是否吃到食物</span>
<span class="token comment">// 如果蛇头和食物的位置重合代表吃到食物</span>
<span class="token comment">// 食物的坐标是像素，蛇的坐标是几个宽度，进行转换</span>
<span class="token keyword">var</span> headX <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>body<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">;</span>
<span class="token keyword">var</span> headY <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>body<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>headX <span class="token operator">===</span> food<span class="token punctuation">.</span>x <span class="token operator">&amp;&amp;</span> headY <span class="token operator">===</span> food<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 吃到食物，往蛇节的最后加一节</span>
  <span class="token keyword">var</span> last <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>body<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>body<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    x<span class="token punctuation">:</span> last<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
    y<span class="token punctuation">:</span> last<span class="token punctuation">.</span>y<span class="token punctuation">,</span>
    color<span class="token punctuation">:</span> last<span class="token punctuation">.</span>color
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// 把现在的食物对象删除，并重新随机渲染一个食物对象</span>
  food<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3><a id="_348"></a>其它处理</h3>
<h4><a id="htmljsindexjs_350"></a>把html中的js代码放到index.js中</h4>
<p>避免html中出现js代码</p>
<h4><a id="_354"></a>自调用函数的参数</h4>
<pre><code class="prism language-js"><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>window<span class="token punctuation">,</span> undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> document <span class="token operator">=</span> window<span class="token punctuation">.</span>document<span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> undefined<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li>传入window对象</li>
</ul>
<p>将来代码压缩的时候，可以吧 function (window)  压缩成 function (w)</p>
<ul>
<li>传入undefined</li>
</ul>
<p>在将来会看到别人写的代码中会把undefined作为函数的参数(当前案例没有使用)<br>
因为在有的老版本的浏览器中 undefined可以被重新赋值，防止undefined 被重新赋值</p>
<h4><a id="_372"></a>整理代码</h4>
<p>现在的代码结构清晰，谁出问题就找到对应的js文件即可。<br>
通过自调用函数，已经防止了变量命名污染的问题</p>
<p>但是，由于js文件数较多，需要在页面上引用，会产生文件依赖的问题(先引入那个js，再引入哪个js)<br>
将来通过工具把js文件合并并压缩。现在手工合并js文件演示</p>
<ul>
<li>问题1</li>
</ul>
<pre><code class="prism language-js"><span class="token comment">// 如果存在多个自调用函数要用分号分割，否则语法错误</span>
<span class="token comment">// 下面代码会报错</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 所以代码规范中会建议在自调用函数之前加上分号</span>
<span class="token comment">// 下面代码没有问题</span>
<span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li>问题2</li>
</ul>
<pre><code class="prism language-js"><span class="token comment">// 当自调用函数 前面有函数声明时，会把自调用函数作为参数</span>
<span class="token comment">// 所以建议自调用函数前，加上;</span>
<span class="token keyword">var</span> <span class="token function-variable function">a</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'11'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
    
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'22'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<hr>
</div>
</body>

</html>
