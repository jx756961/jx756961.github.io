<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vue全家桶学习 三、promise封装axios使用详解</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
<h2 style="text-align: center">Vue全家桶学习 三、promise封装axios使用详解</h2>
  <div class="stackedit__html"><h5><a id="1_axios_0"></a>1. 安装axios</h5>
<ul>
<li>npm命令
<ul>
<li>npm install axios --save</li>
</ul>
</li>
<li>yarn命令
<ul>
<li>yarn add axios</li>
</ul>
</li>
</ul>
<h5><a id="2_axios__Promise__5"></a>2. axios  Promise 封装个人案例</h5>
<pre><code class="prism language-javascript">	<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>
	
	<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Axios</span>  <span class="token punctuation">{</span>
	  <span class="token keyword">static</span> <span class="token function">ajax</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">{</span>
	    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	      <span class="token keyword">let</span> baseUrl <span class="token operator">=</span><span class="token string">'www.baseurl.com'</span>
	      <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	        url<span class="token punctuation">:</span>options<span class="token punctuation">.</span>url<span class="token punctuation">,</span>
	        method<span class="token punctuation">:</span>options<span class="token punctuation">.</span>method<span class="token punctuation">,</span>
	        baseURL<span class="token punctuation">:</span>baseUrl<span class="token punctuation">,</span>
	        timeout<span class="token punctuation">:</span><span class="token number">5000</span><span class="token punctuation">,</span>
	        params<span class="token punctuation">:</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>data <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>data<span class="token punctuation">.</span>params <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span>
	      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	        <span class="token keyword">if</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">===</span><span class="token number">200</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
	          <span class="token keyword">if</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>code <span class="token operator">===</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	            <span class="token function">reslove</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
	          <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
	            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
	          <span class="token punctuation">}</span>
	        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
	          <span class="token function">reject</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
	        <span class="token punctuation">}</span>
	      <span class="token punctuation">}</span><span class="token punctuation">)</span>
	    <span class="token punctuation">}</span><span class="token punctuation">)</span>
	  <span class="token punctuation">}</span>
	  <span class="token comment">//....后面可以继续封装其他方法</span>
	<span class="token punctuation">}</span>
</code></pre>
<h5><a id="3axios__37"></a>3.axios 可用的实例方法和请求配置详解</h5>
<ol>
<li>实例方法</li>
</ol>
<pre><code class="prism language-javascript">	
	以下是可用的实例方法。指定的配置将与实例的配置合并
	
	axios#<span class="token function">request</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
	axios#<span class="token keyword">get</span><span class="token punctuation">(</span>url<span class="token punctuation">[</span><span class="token punctuation">,</span> config<span class="token punctuation">]</span><span class="token punctuation">)</span>
	axios#<span class="token keyword">delete</span><span class="token punctuation">(</span>url<span class="token punctuation">[</span><span class="token punctuation">,</span> config<span class="token punctuation">]</span><span class="token punctuation">)</span>
	axios#<span class="token function">head</span><span class="token punctuation">(</span>url<span class="token punctuation">[</span><span class="token punctuation">,</span> config<span class="token punctuation">]</span><span class="token punctuation">)</span>
	axios#<span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">[</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token punctuation">,</span> config<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	axios#<span class="token function">put</span><span class="token punctuation">(</span>url<span class="token punctuation">[</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token punctuation">,</span> config<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	axios#<span class="token function">patch</span><span class="token punctuation">(</span>url<span class="token punctuation">[</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token punctuation">,</span> config<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<ol start="2">
<li>请求配置</li>
</ol>
<pre><code class="prism language-javascript">	
	这些是创建请求时可以用的配置选项。只有 url 是必需的。如果没有指定 method，请求将默认使用 <span class="token keyword">get</span> 方法。
	
	<span class="token punctuation">{</span>
	  <span class="token comment">// `url` 是用于请求的服务器 URL</span>
	  url<span class="token punctuation">:</span> <span class="token string">'/user'</span><span class="token punctuation">,</span>
	
	  <span class="token comment">// `method` 是创建请求时使用的方法</span>
	  method<span class="token punctuation">:</span> <span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token comment">// 默认是 get</span>
	
	  <span class="token comment">// `baseURL` 将自动加在 `url` 前面，除非 `url` 是一个绝对 URL。</span>
	  <span class="token comment">// 它可以通过设置一个 `baseURL` 便于为 axios 实例的方法传递相对 URL</span>
	  baseURL<span class="token punctuation">:</span> <span class="token string">'https://some-domain.com/api/'</span><span class="token punctuation">,</span>
	
	  <span class="token comment">// `transformRequest` 允许在向服务器发送前，修改请求数据</span>
	  <span class="token comment">// 只能用在 'PUT', 'POST' 和 'PATCH' 这几个请求方法</span>
	  <span class="token comment">// 后面数组中的函数必须返回一个字符串，或 ArrayBuffer，或 Stream</span>
	  transformRequest<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token comment">// 对 data 进行任意转换处理</span>
	
	    <span class="token keyword">return</span> data<span class="token punctuation">;</span>
	  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	
	  <span class="token comment">// `transformResponse` 在传递给 then/catch 前，允许修改响应数据</span>
	  transformResponse<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token comment">// 对 data 进行任意转换处理</span>
	
	    <span class="token keyword">return</span> data<span class="token punctuation">;</span>
	  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	
	  <span class="token comment">// `headers` 是即将被发送的自定义请求头</span>
	  headers<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'X-Requested-With'</span><span class="token punctuation">:</span> <span class="token string">'XMLHttpRequest'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	
	  <span class="token comment">// `params` 是即将与请求一起发送的 URL 参数</span>
	  <span class="token comment">// 必须是一个无格式对象(plain object)或 URLSearchParams 对象</span>
	  params<span class="token punctuation">:</span> <span class="token punctuation">{</span>
	    <span class="token constant">ID</span><span class="token punctuation">:</span> <span class="token number">12345</span>
	  <span class="token punctuation">}</span><span class="token punctuation">,</span>
	
	  <span class="token comment">// `paramsSerializer` 是一个负责 `params` 序列化的函数</span>
	  <span class="token comment">// (e.g. https://www.npmjs.com/package/qs, http://api.jquery.com/jquery.param/)</span>
	  paramsSerializer<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token keyword">return</span> Qs<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> <span class="token punctuation">{</span>arrayFormat<span class="token punctuation">:</span> <span class="token string">'brackets'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	  <span class="token punctuation">}</span><span class="token punctuation">,</span>
	
	  <span class="token comment">// `data` 是作为请求主体被发送的数据</span>
	  <span class="token comment">// 只适用于这些请求方法 'PUT', 'POST', 和 'PATCH'</span>
	  <span class="token comment">// 在没有设置 `transformRequest` 时，必须是以下类型之一：</span>
	  <span class="token comment">// - string, plain object, ArrayBuffer, ArrayBufferView, URLSearchParams</span>
	  <span class="token comment">// - 浏览器专属：FormData, File, Blob</span>
	  <span class="token comment">// - Node 专属： Stream</span>
	  data<span class="token punctuation">:</span> <span class="token punctuation">{</span>
	    firstName<span class="token punctuation">:</span> <span class="token string">'Fred'</span>
	  <span class="token punctuation">}</span><span class="token punctuation">,</span>
	
	  <span class="token comment">// `timeout` 指定请求超时的毫秒数(0 表示无超时时间)</span>
	  <span class="token comment">// 如果请求话费了超过 `timeout` 的时间，请求将被中断</span>
	  timeout<span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
	
	  <span class="token comment">// `withCredentials` 表示跨域请求时是否需要使用凭证</span>
	  withCredentials<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 默认的</span>
	
	  <span class="token comment">// `adapter` 允许自定义处理请求，以使测试更轻松</span>
	  <span class="token comment">// 返回一个 promise 并应用一个有效的响应 (查阅 [response docs](#response-api)).</span>
	  adapter<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token comment">/* ... */</span>
	  <span class="token punctuation">}</span><span class="token punctuation">,</span>
	
	  <span class="token comment">// `auth` 表示应该使用 HTTP 基础验证，并提供凭据</span>
	  <span class="token comment">// 这将设置一个 `Authorization` 头，覆写掉现有的任意使用 `headers` 设置的自定义 `Authorization`头</span>
	  auth<span class="token punctuation">:</span> <span class="token punctuation">{</span>
	    username<span class="token punctuation">:</span> <span class="token string">'janedoe'</span><span class="token punctuation">,</span>
	    password<span class="token punctuation">:</span> <span class="token string">'s00pers3cret'</span>
	  <span class="token punctuation">}</span><span class="token punctuation">,</span>
	
	  <span class="token comment">// `responseType` 表示服务器响应的数据类型，可以是 'arraybuffer', 'blob', 'document', 'json', 'text', 'stream'</span>
	  responseType<span class="token punctuation">:</span> <span class="token string">'json'</span><span class="token punctuation">,</span> <span class="token comment">// 默认的</span>
	
	  <span class="token comment">// `xsrfCookieName` 是用作 xsrf token 的值的cookie的名称</span>
	  xsrfCookieName<span class="token punctuation">:</span> <span class="token string">'XSRF-TOKEN'</span><span class="token punctuation">,</span> <span class="token comment">// default</span>
	
	  <span class="token comment">// `xsrfHeaderName` 是承载 xsrf token 的值的 HTTP 头的名称</span>
	  xsrfHeaderName<span class="token punctuation">:</span> <span class="token string">'X-XSRF-TOKEN'</span><span class="token punctuation">,</span> <span class="token comment">// 默认的</span>
	
	  <span class="token comment">// `onUploadProgress` 允许为上传处理进度事件</span>
	  onUploadProgress<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>progressEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token comment">// 对原生进度事件的处理</span>
	  <span class="token punctuation">}</span><span class="token punctuation">,</span>
	
	  <span class="token comment">// `onDownloadProgress` 允许为下载处理进度事件</span>
	  onDownloadProgress<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>progressEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token comment">// 对原生进度事件的处理</span>
	  <span class="token punctuation">}</span><span class="token punctuation">,</span>
	
	  <span class="token comment">// `maxContentLength` 定义允许的响应内容的最大尺寸</span>
	  maxContentLength<span class="token punctuation">:</span> <span class="token number">2000</span><span class="token punctuation">,</span>
	
	  <span class="token comment">// `validateStatus` 定义对于给定的HTTP 响应状态码是 resolve 或 reject  promise 。如果 `validateStatus` 返回 `true` (或者设置为 `null` 或 `undefined`)，promise 将被 resolve; 否则，promise 将被 rejecte</span>
	  validateStatus<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token keyword">return</span> status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">;</span> <span class="token comment">// 默认的</span>
	  <span class="token punctuation">}</span><span class="token punctuation">,</span>
	
	  <span class="token comment">// `maxRedirects` 定义在 node.js 中 follow 的最大重定向数目</span>
	  <span class="token comment">// 如果设置为0，将不会 follow 任何重定向</span>
	  maxRedirects<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token comment">// 默认的</span>
	
	  <span class="token comment">// `httpAgent` 和 `httpsAgent` 分别在 node.js 中用于定义在执行 http 和 https 时使用的自定义代理。允许像这样配置选项：</span>
	  <span class="token comment">// `keepAlive` 默认没有启用</span>
	  httpAgent<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">http<span class="token punctuation">.</span>Agent</span><span class="token punctuation">(</span><span class="token punctuation">{</span> keepAlive<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	  httpsAgent<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">https<span class="token punctuation">.</span>Agent</span><span class="token punctuation">(</span><span class="token punctuation">{</span> keepAlive<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	
	  <span class="token comment">// 'proxy' 定义代理服务器的主机名称和端口</span>
	  <span class="token comment">// `auth` 表示 HTTP 基础验证应当用于连接代理，并提供凭据</span>
	  <span class="token comment">// 这将会设置一个 `Proxy-Authorization` 头，覆写掉已有的通过使用 `header` 设置的自定义 `Proxy-Authorization` 头。</span>
	  proxy<span class="token punctuation">:</span> <span class="token punctuation">{</span>
	    host<span class="token punctuation">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>
	    port<span class="token punctuation">:</span> <span class="token number">9000</span><span class="token punctuation">,</span>
	    auth<span class="token punctuation">:</span> <span class="token punctuation">:</span> <span class="token punctuation">{</span>
	      username<span class="token punctuation">:</span> <span class="token string">'mikeymike'</span><span class="token punctuation">,</span>
	      password<span class="token punctuation">:</span> <span class="token string">'rapunz3l'</span>
	    <span class="token punctuation">}</span>
	  <span class="token punctuation">}</span><span class="token punctuation">,</span>
	
	  <span class="token comment">// `cancelToken` 指定用于取消请求的 cancel token</span>
	  <span class="token comment">// （查看后面的 Cancellation 这节了解更多）</span>
	  cancelToken<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">CancelToken</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>cancel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	  <span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
</code></pre>
<ol start="3">
<li>响应结构</li>
</ol>
<pre><code class="prism language-javascript">
	某个请求的响应包含以下信息
	
	<span class="token punctuation">{</span>
	  <span class="token comment">// `data` 由服务器提供的响应</span>
	  data<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	
	  <span class="token comment">// `status` 来自服务器响应的 HTTP 状态码</span>
	  status<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
	
	  <span class="token comment">// `statusText` 来自服务器响应的 HTTP 状态信息</span>
	  statusText<span class="token punctuation">:</span> <span class="token string">'OK'</span><span class="token punctuation">,</span>
	
	  <span class="token comment">// `headers` 服务器响应的头</span>
	  headers<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	
	  <span class="token comment">// `config` 是为请求提供的配置信息</span>
	  config<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	使用 then 时，你将接收下面这样的响应：

	axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/user/12345'</span><span class="token punctuation">)</span>
	  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>headers<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
	  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	在使用 <span class="token keyword">catch</span> 时，或传递 rejection callback 作为 then 的第二个参数时，响应可以通过 error 对象可被使用，正如在错误处理这一节所讲。
</code></pre>
<ol start="4">
<li>配置的默认值/defaults</li>
</ol>
<pre><code class="prism language-javascript">	<span class="token comment">//指定将被用在各个请求的配置默认值</span>
	<span class="token comment">//全局的 axios 默认值</span>
	axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>baseURL <span class="token operator">=</span> <span class="token string">'https://api.example.com'</span><span class="token punctuation">;</span>
	axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>common<span class="token punctuation">[</span><span class="token string">'Authorization'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">AUTH_TOKEN</span><span class="token punctuation">;</span>
	axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>post<span class="token punctuation">[</span><span class="token string">'Content-Type'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">;</span>
</code></pre>
<ol start="5">
<li>自定义默认值</li>
</ol>
<pre><code class="prism language-javascript">	<span class="token comment">// 创建实例时设置配置的默认值</span>
	<span class="token keyword">var</span> instance <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	  baseURL<span class="token punctuation">:</span> <span class="token string">'https://api.example.com'</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 在实例已创建后修改默认值</span>
	instance<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>common<span class="token punctuation">[</span><span class="token string">'Authorization'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">AUTH_TOKEN</span><span class="token punctuation">;</span>
</code></pre>
<ol start="6">
<li>配置的优先顺序</li>
</ol>
<pre><code class="prism language-javascript">
	<span class="token comment">//配置会以一个优先顺序进行合并。这个顺序是：在 lib/defaults.js 找到的库的默认值，然后是实例的 defaults 属性，最后是请求的 config 参数。后者将优先于前者。这里是一个例子：</span>
	
	<span class="token comment">// 使用由库提供的配置的默认值来创建实例</span>
	<span class="token comment">// 此时超时配置的默认值是 `0`</span>
	<span class="token keyword">var</span> instance <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 覆写库的超时默认值</span>
	<span class="token comment">// 现在，在超时前，所有请求都会等待 2.5 秒</span>
	instance<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">2500</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 为已知需要花费很长时间的请求覆写超时设置</span>
	instance<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/longRequest'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	  timeout<span class="token punctuation">:</span> <span class="token number">5000</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<ol start="7">
<li>拦截器的使用</li>
</ol>
<pre><code class="prism language-javascript">	<span class="token comment">//在请求或响应被 then 或 catch 处理前拦截它们。</span>

	<span class="token comment">// 添加请求拦截器</span>
	axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token comment">// 在发送请求之前做些什么</span>
	    <span class="token keyword">return</span> config<span class="token punctuation">;</span>
	  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token comment">// 对请求错误做些什么</span>
	    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
	  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 添加响应拦截器</span>
	axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token comment">// 对响应数据做点什么</span>
	    <span class="token keyword">return</span> response<span class="token punctuation">;</span>
	  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token comment">// 对响应错误做点什么</span>
	    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
	  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	如果你想在稍后移除拦截器，可以这样：
	
	<span class="token keyword">var</span> myInterceptor <span class="token operator">=</span> axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">/*...*/</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">eject</span><span class="token punctuation">(</span>myInterceptor<span class="token punctuation">)</span><span class="token punctuation">;</span>
	可以为自定义 axios 实例添加拦截器
	
	<span class="token keyword">var</span> instance <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	instance<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">/*...*/</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<ol start="8">
<li>错误处理</li>
</ol>
<pre><code class="prism language-javascript">	axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/user/12345'</span><span class="token punctuation">)</span>
	  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	      <span class="token comment">// 请求已发出，但服务器响应的状态码不在 2xx 范围内</span>
	      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
	      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
	      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>response<span class="token punctuation">.</span>headers<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
	      <span class="token comment">// Something happened in setting up the request that triggered an Error</span>
	      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Error'</span><span class="token punctuation">,</span> error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
	  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	可以使用 validateStatus 配置选项定义一个自定义 <span class="token constant">HTTP</span> 状态码的错误范围。
	
	axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/user/12345'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	  validateStatus<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token keyword">return</span> status <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">;</span> <span class="token comment">// 状态码在大于或等于500时才会 reject</span>
	  <span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<ol start="9">
<li>取消请求<br>
<strong>注 : 可以使用同一个 cancel token 取消多个请求</strong></li>
</ol>
<pre><code class="prism language-javascript">	
	使用 cancel token 取消请求
	
	Axios 的 cancel token <span class="token constant">API</span> 基于cancelable promises proposal，它还处于第一阶段。
	
	可以使用 CancelToken<span class="token punctuation">.</span>source 工厂方法创建 cancel token，像这样：
	
	<span class="token keyword">var</span> CancelToken <span class="token operator">=</span> axios<span class="token punctuation">.</span>CancelToken<span class="token punctuation">;</span>
	<span class="token keyword">var</span> source <span class="token operator">=</span> CancelToken<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/user/12345'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	  cancelToken<span class="token punctuation">:</span> source<span class="token punctuation">.</span>token
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>thrown<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	  <span class="token keyword">if</span> <span class="token punctuation">(</span>axios<span class="token punctuation">.</span><span class="token function">isCancel</span><span class="token punctuation">(</span>thrown<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Request canceled'</span><span class="token punctuation">,</span> thrown<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
	  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
	    <span class="token comment">// 处理错误</span>
	  <span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 取消请求（message 参数是可选的）</span>
	source<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token string">'Operation canceled by the user.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	还可以通过传递一个 executor 函数到 CancelToken 的构造函数来创建 cancel token：
	
	<span class="token keyword">var</span> CancelToken <span class="token operator">=</span> axios<span class="token punctuation">.</span>CancelToken<span class="token punctuation">;</span>
	<span class="token keyword">var</span> cancel<span class="token punctuation">;</span>
	
	axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/user/12345'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	  cancelToken<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">CancelToken</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">executor</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token comment">// executor 函数接收一个 cancel 函数作为参数</span>
	    cancel <span class="token operator">=</span> c<span class="token punctuation">;</span>
	  <span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 取消请求</span>
	<span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
</code></pre>
</div>
</body>

</html>
